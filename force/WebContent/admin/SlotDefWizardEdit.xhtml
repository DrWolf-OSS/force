<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template.xhtml">

<ui:define name="body">

    <h:form id="slotDef" styleClass="edit" onkeypress="dirty=true">
    
    	<script type="text/javascript" src="/force/javascript/exitInterceptor.js"/>
    	
    	<s:div styleClass="messageBox" >
		<ui:repeat var="message" value="#{slotDefEditBean.messages}">
			<h:graphicImage value="/img/msgerror.png"  styleClass="fileIcon"
				rendered="#{message.type == 'ERROR'}" />
			<h:graphicImage value="/img/msgwarn.png"  styleClass="fileIcon"
				rendered="#{message.type == 'WARNING'}" />
			<h:graphicImage value="/img/tick.png"  styleClass="fileIcon"
				rendered="#{message.type == 'VALID'}" />
			<h:outputText value="#{message.text}" />
			<br />
		</ui:repeat>
		</s:div>
		<div style="clear: both"/>

        <rich:panel style="width:auto">
            <f:facet name="header">#{slotDefHome.managed ? 'Modifica' : 'Creazione'} #{slotDefParameters.model ? 'modello di' : ''} #{slotDefParameters.mode=='PRIMARY' ? 'Busta di Riferimento' : 'Busta Amministrativa'}</f:facet>

			<ui:remove>   
            <s:decorate id="templateFieldView" template="/layout/display.xhtml" rendered="#{not slotDefParameters.model}">
                <ui:define name="label">Modello</ui:define>
                <h:outputText value="#{slotDefParameters.model ? 'Sì' : 'No'}" />
            </s:decorate>
            </ui:remove>

			<a:region>
            <s:decorate id="nameField" template="/layout/edit.xhtml">
                <ui:define name="label">Nome</ui:define>
                <h:inputTextarea id="name" value="#{slotDefHome.instance.name}" required="true" style="width:525px" />
            </s:decorate>
            </a:region>
            
            <s:decorate id="statusField" template="/layout/display.xhtml">
                <ui:define name="label">Stato</ui:define>
                <h:graphicImage value="/img/cross.png"  styleClass="fileIcon"
							rendered="#{slotDefHome.instance.status == 'INVALID'}" />
				<h:graphicImage value="/img/tick.png"  styleClass="fileIcon"
							rendered="#{slotDefHome.instance.status == 'VALID'}" />
                <h:outputText id="status" value="#{slotDefHome.instance.status.value()}" />
            </s:decorate>
            
            <s:decorate id="typeField" template="/layout/edit.xhtml" rendered="#{slotDefParameters.mode == 'Normal'}">
                <ui:define name="label">Tipo</ui:define>
                <h:selectOneMenu id="slotDefType" value="#{slotDefHome.instance.type}" >
                    	<s:selectItems value="#{slotDefEditBean.slotDefTypes}" 
						var="slotDefType" label="#{slotDefType.value()}"/>
						<s:convertEnum/>
             	</h:selectOneMenu>
            </s:decorate>
            
            <s:div rendered="#{slotDefHome.instance.id != null and slotDefHome.instance.type == 'DEPENDENT' and not slotDefHome.instance.template 
            					and s:hasRole('ADMIN')}">
            
	            <s:decorate id="parentSlot" template="/layout/display.xhtml">
	                <ui:define name="label">Busta Contenitrice</ui:define>
	                <s:link view="/admin/SlotDefView.xhtml" value="#{slotDefHome.instance.parentSlotDef.name}"
	                		action="#{slotDefEditBean.validate}" 
	                		propagation="none">
	                	<f:param name="mode" value="#{slotDefHome.instance.parentSlotDef.type.name()}"/>
						<f:param name="model" value="#{slotDefHome.instance.parentSlotDef.template}"/>
						<f:param name="slotDefId" value="#{slotDefHome.instance.parentSlotDef.id}"/>
	                </s:link>
	            </s:decorate>
            
	            <s:div id="condPD" >
	            <a:region>
					<s:decorate template="/layout/edit.xhtml">
		                <ui:define name="label">
		                	<h:outputText value="Informazione vincolante" />
						</ui:define>
						<h:selectOneMenu  value="#{slotDefHome.instance.conditionalPropertyDef}" 
									converter="propertyDefConverter"
									disabled="#{slotDefHome.instance.id != null and slotDefHome.instance.referenced}">
	     					<s:selectItems value="#{slotDefHome.instance.parentSlotDef.propertyDefsAsList}" label="#{propertyDef.name}"
										var="propertyDef"  noSelectionLabel="-- select a value --" 
										itemLabel="#{propertyDef.id}" itemValue="#{propertyDef.id}:#{propertyDef.uuid}" 
										disabled="#{(not propertyDef.multiple) and (propertyDef.dictionary == null) and (propertyDef.dataType != 'BOOLEAN')}"/>
							<a:support event="onchange" action="#{slotDefEditBean.conditionalPropertyListenerForConditionable(slotDefHome.instance)}" reRender="condValue,condPD"/>
						</h:selectOneMenu>
		            </s:decorate>
		        </a:region>
		        </s:div>
	        
	        
		         <s:div id="condValue">
		         <a:region>
					<s:decorate  template="/layout/edit.xhtml" rendered="#{slotDefHome.instance.conditionalPropertyDef != null}" >	            	
		                <ui:define name="label">
		                	<h:outputText value="Valore vincolante" />
						</ui:define>
						<h:inputText value="#{slotDefHome.instance.conditionalPropertyInst.stringValue}"
							rendered="#{slotDefHome.instance.conditionalPropertyDef.dataType == 'STRING' and slotDefHome.instance.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefHome.instance.conditionalPropertyDef != null}"/>
						<h:inputText value="#{slotDefHome.instance.conditionalPropertyInst.integerValue}"
							rendered="#{slotDefHome.instance.conditionalPropertyDef.dataType == 'INTEGER' and slotDefHome.instance.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefHome.instance.conditionalPropertyDef != null}"/>
						<h:selectBooleanCheckbox value="#{slotDefHome.instance.conditionalPropertyInst.booleanValue}"
							rendered="#{slotDefHome.instance.conditionalPropertyDef.dataType == 'BOOLEAN'}"
							required="#{slotDefHome.instance.conditionalPropertyDef != null}"/>
						<rich:calendar id="subscriptionDate" mode="client"
							value="#{slotDefHome.instance.conditionalPropertyInst.dateValue}" datePattern="dd/MM/yyyy"
							rendered="#{slotDefHome.instance.conditionalPropertyDef.dataType == 'DATE' and slotDefHome.instance.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefHome.instance.conditionalPropertyDef != null}"/>
							
						
						<h:selectOneMenu value="#{slotDefHome.instance.conditionalPropertyInst.stringValue}" required="#{slotDefHome.instance.conditionalPropertyDef != null}"
									rendered="#{slotDefHome.instance.conditionalPropertyDef.dataType == 'STRING' and slotDefHome.instance.conditionalPropertyDef.dictionaryValues != null}"
									disabled="#{slotDefHome.instance.id != null and slotDefHome.instance.referenced}">
                    		<s:selectItems value="#{slotDefHome.instance.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
             			</h:selectOneMenu>
             			<h:selectOneMenu value="#{slotDefHome.instance.conditionalPropertyInst.integerValue}" required="#{slotDefHome.instance.conditionalPropertyDef != null}"
									rendered="#{slotDefHome.instance.conditionalPropertyDef.dataType == 'INTEGER' and slotDefHome.instance.conditionalPropertyDef.dictionaryValues != null}"
									disabled="#{slotDefHome.instance.id != null and slotDefHome.instance.referenced}">
                    		<s:selectItems value="#{slotDefHome.instance.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
             			</h:selectOneMenu>
             			<h:selectOneMenu value="#{slotDefHome.instance.conditionalPropertyInst.dateValue}"  required="#{slotDefHome.instance.conditionalPropertyDef != null}"
             						rendered="#{slotDefHome.instance.conditionalPropertyDef.dataType == 'DATE' and slotDefHome.instance.conditionalPropertyDef.dictionaryValues != null}"
             						disabled="#{slotDefHome.instance.id != null and slotDefHome.instance.referenced}">
                    		<s:selectItems value="#{slotDefHome.instance.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
							<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
             			</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            </s:div>
	            
	            <s:div id="instances" >
				<a:region>
				<s:decorate template="/layout/edit.xhtml" 
							rendered="#{slotDefHome.instance.id != null and slotDefHome.instance.type == 'DEPENDENT' and not slotDefHome.instance.template 
            					and not s:hasRole('ADMIN')}">
	                <ui:define name="label">
	                	<h:outputText value="Info contenente numero di copie" />
					</ui:define>
					<h:selectOneMenu  value="#{slotDefHome.instance.numberOfInstances}" required="true"
								converter="propertyDefConverter"
								disabled="#{slotDefHome.instance.id != null and slotDefHome.instance.referenced}">
     					<s:selectItems value="#{slotDefHome.instance.parentSlotDef.propertyDefsAsList}" label="#{propertyDef.name}"
									var="propertyDef"  noSelectionLabel="-- select a value --" 
									itemLabel="#{propertyDef.id}" itemValue="#{propertyDef.id}:#{propertyDef.uuid}" 
									disabled="#{propertyDef.dataType != 'INTEGER' or not propertyDef.required}"/>
					</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            </s:div>
            
            </s:div>
            
            <s:div rendered="#{slotDefHome.instance.id != null and slotDefHome.instance.type == 'DEPENDENT' and not slotDefHome.instance.template 
            					and (not s:hasRole('ADMIN') and not slotDefHome.instance.parentSlotDef.template)}">
            	<s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Numero di copie" />
					</ui:define>
					<h:inputText value="#{slotDefHome.instance.embeddedNumberOfInstances.integerValue}" disabled="#{slotDefHome.instance.referenced}"/>
	            </s:decorate>
            </s:div>
			
			<div style="clear:both"/>
			<rich:separator height="25px" lineType="none" rendered="#{slotDefParameters.mode != 'PRIMARY'}"/>
			
			<s:decorate template="/layout/display.xhtml" rendered="#{slotDefParameters.mode != 'PRIMARY'}" id="epropTable">
				<ui:define name="label">
	                <h:outputText value="Informazioni sulla gara" />
				</ui:define>
				<h:outputText value="Nessuna informazione definita" rendered="#{empty slotDefHome.instance.embeddedPropertiesAsList}"/>
				<rich:dataTable value="#{slotDefHome.instance.embeddedPropertiesAsList}" var="eprop" 
						rendered="#{not empty slotDefHome.instance.embeddedPropertiesAsList}" 
						style="width:1024px" 
						onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
						onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
					<rich:column style="width:200px; font-weight:bold;" styleClass="#{!eprop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Nome</f:facet>
						<h:graphicImage value="/img/cross.png"  styleClass="fileIcon"
							rendered="#{eprop.status == 'INVALID'}" />
						<h:outputText value="#{eprop.name}" />
					</rich:column>
					<rich:column styleClass="#{!eprop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Tipologia di dato</f:facet>
						<h:outputText value="#{eprop.dataType.value()}" />
					</rich:column>
					<rich:column styleClass="#{!eprop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Validatore</f:facet>
						<h:outputText value="#{eprop.constraint != null ? eprop.constraint.name : ''}" />
					</rich:column>
					<rich:column styleClass="#{!eprop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Multipla</f:facet>
						<h:outputText value="#{eprop.multiple ? 'sì' : 'no'}" />
					</rich:column>
					<rich:column styleClass="#{!eprop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Valore</f:facet>
						<s:fragment rendered="#{not eprop.multiple}">
							<h:outputText value="#{eprop.stringValue}"
									rendered="#{eprop.dataDefinition.dataType == 'STRING' or eprop.dataDefinition.dataType == 'LINK'}"/>
							<h:outputText value="#{eprop.integerValue}"
									rendered="#{eprop.dataDefinition.dataType == 'INTEGER'}" />
							<h:outputText value="#{eprop.booleanValue ? 'true' : 'false'}"
									rendered="#{eprop.dataDefinition.dataType == 'BOOLEAN'}" />
							<h:outputText value="#{eprop.dateValue}"
									rendered="#{eprop.dataDefinition.dataType == 'DATE'}">
								<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
							</h:outputText>
						</s:fragment>
						<s:fragment rendered="#{eprop.multiple}">
							<h:outputText value="#{eprop.value}" />
						</s:fragment>
					</rich:column>
					<rich:column styleClass="#{!eprop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Regole in cui è coinvolta</f:facet>
						<a:repeat var="rule" value="#{slotDefEditBean.retrieveReferencedRules(eprop)}" rowKeyVar="idx">
							<h:outputText value="Regola #{rule.id}" />
							<h:outputText value=", " rendered="#{idx lt slotDefEditBean.retrieveReferencedRules(eprop).size()-1}"/>
						</a:repeat>
					</rich:column>
					<rich:column styleClass="action #{!eprop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Azioni</f:facet>
		                <a:commandLink value="Modifica" action="#{slotDefEditBean.editEmbeddedProp(eprop)}" 
		            			oncomplete="#{rich:component('embeddedPropPanel')}.show()"
		            			disabled="#{not eprop.active}"
            					styleClass="#{not eprop.active ? 'disabledLink' : ''}"
		            			reRender="embeddedPropPanel"/>
		                #{' '}
						<a:commandLink id="delete" value="Elimina" action="#{slotDefEditBean.removeEmbeddedProp(eprop)}" 
            						onclick="if(!confRules('#{slotDefEditBean.retrieveReferencedRulesLabel(eprop)}')){return false;}else{dirty=true;}"
            						reRender="epropTable,propTable,collTable"
            						rendered="#{not slotDefHome.referenced or eprop.id==null}"/>
            						
            			<a:commandLink id="invalidate" value="#{eprop.active ? 'Invalida' : 'Riattiva'}" action="#{slotDefEditBean.invalidate(eprop)}"
            						onclick="dirty=true"
            						disabled="#{not empty slotDefEditBean.retrieveReferencedRules(eprop)}"
            						styleClass="#{not empty slotDefEditBean.retrieveReferencedRules(eprop) ? 'disabledLink' : ''}"
            						reRender="epropTable"
            						rendered="#{slotDefHome.referenced and eprop.id!=null}"/>
            			<rich:toolTip for="invalidate" attached="true" rendered="#{not empty slotDefEditBean.retrieveReferencedRules(eprop)}">
            			L'informazione è coinvolta in una regola e non può essere rimossa. Eliminare prima la regola che la referenzia</rich:toolTip>
					</rich:column>
				</rich:dataTable>
			</s:decorate>
            
            <div style="clear:both"/>
            <rich:separator height="25px" lineType="none" rendered="#{s:hasRole('ADMIN') or slotDefHome.instance.template}"/>
            
			<s:decorate template="/layout/display.xhtml" id="propTable" rendered="#{s:hasRole('ADMIN')}">
				<ui:define name="label">
	                <h:outputText value="Informazioni sull'azienda" />
				</ui:define>
				<h:outputText value="Nessuna informazione definita" rendered="#{empty slotDefHome.instance.propertyDefsAsList}"/>
				<rich:dataTable value="#{slotDefHome.instance.propertyDefsAsList}" var="prop" 
						rendered="#{not empty slotDefHome.instance.propertyDefsAsList}" 
						onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
						onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
					<rich:column style="width:200px; font-weight:bold;" styleClass="#{!prop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Nome</f:facet>
						<h:graphicImage value="/img/cross.png"  styleClass="fileIcon"
							rendered="#{prop.status == 'INVALID'}" />
						<h:outputText value="#{prop.name}" />
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Tipologia di dato</f:facet>
						<h:outputText value="#{prop.dataType.value()}" />
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Validatore</f:facet>
						<h:outputText value="#{prop.constraint != null ? prop.constraint.name : ''}" />
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Obbligatoria</f:facet>
						<h:outputText value="#{prop.required ? 'sì' : 'no'}" />
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Multipla</f:facet>
						<h:outputText value="#{prop.multiple ? 'sì' : 'no'}" />
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Dizionario associato</f:facet>
						<h:outputText value="#{prop.dictionary!=null ? prop.dictionary.name : ''}" />
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}" rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Informazione vincolante</f:facet>
						<h:outputText value="#{prop.conditionalPropertyDef!=null ? prop.conditionalPropertyDef.name : ''}" />
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}" rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Valore informazione vincolante</f:facet>
						<h:outputText value="#{prop.conditionalPropertyInst.stringValue}"
								rendered="#{prop.conditionalPropertyInst.dataDefinition.dataType == 'STRING' or dataInstance.dataDefinition.dataType == 'LINK'}"/>
						<h:outputText value="#{prop.conditionalPropertyInst.integerValue}"
								rendered="#{prop.conditionalPropertyInst.dataDefinition.dataType == 'INTEGER'}" />
						<h:outputText value="#{prop.conditionalPropertyInst.booleanValue ? 'true' : 'false'}"
								rendered="#{prop.conditionalPropertyInst.dataDefinition.dataType == 'BOOLEAN'}" />
						<h:outputText value="#{prop.conditionalPropertyInst.dateValue}"
								rendered="#{prop.conditionalPropertyInst.dataDefinition.dataType == 'DATE'}">
							<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}" rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Vincolante per le informazioni</f:facet>
						<a:repeat var="pr" value="#{prop.conditionedPropertyDefsAsList}" rowKeyVar="idx">
							<h:outputText value="#{pr.label}" />
							<h:outputText value=", " rendered="#{idx lt prop.conditionedPropertyDefsAsList.size()-1}"/>
						</a:repeat>
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}" rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Vincolante per le richieste</f:facet>
						<a:repeat var="coll" value="#{prop.conditionedDocDefCollectionsAsList}" rowKeyVar="idx">
							<h:outputText value="#{coll.label}" />
							<h:outputText value=", " rendered="#{idx lt prop.conditionedDocDefCollectionsAsList.size()-1}"/>
						</a:repeat>
					</rich:column>
					<rich:column styleClass="#{!prop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Regole in cui è coinvolta</f:facet>
						<a:repeat var="rule" value="#{slotDefEditBean.retrieveReferencedRules(prop)}" rowKeyVar="idx">
							<h:outputText value="Regola #{rule.id}" />
							<h:outputText value=", " rendered="#{idx lt slotDefEditBean.retrieveReferencedRules(prop).size()-1}"/>
						</a:repeat>
					</rich:column>
					<rich:column styleClass="action #{!prop.active ? 'invalidRow' : ''}">
						<f:facet name="header">Azioni</f:facet>
		                <a:commandLink value="Modifica" 
		                				action="#{slotDefEditBean.editProp(prop)}" 
		                				oncomplete="#{rich:component('propPanel')}.show()" 
		                		        disabled="#{not prop.active}"
				                		styleClass="#{not prop.active ? 'disabledLink' : ''}"
		                				reRender="propPanel"/>
		                #{' '}
						<a:commandLink id="delete" value="Elimina" action="#{slotDefEditBean.removeProp(prop)}" 
		                				onclick="if(!conf('#{slotDefEditBean.getReferencedCollectionsNames(prop)}')){return false;}; if(!confRules('#{slotDefEditBean.retrieveReferencedRulesLabel(prop)}')){return false;}else{dirty=true;}"
		                				rendered="#{not slotDefHome.referenced or prop.id==null}"
		                				reRender="collTable,propTable,epropTable"/>
		                				
		                <a:commandLink id="invalidate" value="#{prop.active ? 'Invalida' : 'Riattiva'}" 
		                			onclick="if(!confInvalidate('#{slotDefEditBean.getReferencedCollectionsNames(prop)}')){return false;}else{dirty=true;}"
		                			action="#{slotDefEditBean.invalidate(prop)}"
            						disabled="#{not empty slotDefEditBean.retrieveReferencedRules(prop)}"
            						styleClass="#{not empty slotDefEditBean.retrieveReferencedRules(prop) ? 'disabledLink' : ''}"
            						reRender="propTable,collTable"
            						rendered="#{slotDefHome.referenced and prop.id!=null}"/>
            			<rich:toolTip for="invalidate" attached="true" rendered="#{not empty slotDefEditBean.retrieveReferencedRules(prop)}">
            			L'informazione è coinvolta in una regola e non può essere rimossa. Eliminare prima la regola che la referenzia</rich:toolTip>
            						
					</rich:column>
				</rich:dataTable>
			</s:decorate>
			
			<div style="clear:both"/>
			<rich:separator height="25px" lineType="none" />
			
			<s:decorate template="/layout/display.xhtml" id="collTable">
				<ui:define name="label">
	                <h:outputText value="Documentazione richiesta" />
				</ui:define>
				<h:outputText value="Nessuna documentazione definita" rendered="#{empty slotDefHome.instance.docDefCollectionsAsList}"/>
				<rich:dataTable value="#{slotDefHome.instance.docDefCollectionsAsList}" var="coll" 
						rendered="#{not empty slotDefHome.instance.docDefCollectionsAsList}" 
						style="width:1024px"
						onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
						onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
					<rich:column style="width:200px; font-weight:bold;" stylesimplifiedDependentSlotDefPanelClass="#{!coll.active ? 'invalidRow' : ''}">
						<f:facet name="header">Nome</f:facet>
						<h:graphicImage value="/img/cross.png"  styleClass="fileIcon"
							rendered="#{coll.status == 'INVALID'}" />
						<h:outputText value="#{coll.name}" />
					</rich:column>
					<rich:column styleClass="#{!coll.active ? 'invalidRow' : ''}">
						<f:facet name="header">Tipo di documento</f:facet>
						<h:outputText value="#{coll.docDef.name}" />
					</rich:column>
					<rich:column styleClass="#{!coll.active ? 'invalidRow' : ''}">
						<f:facet name="header">Quantità</f:facet>
						<h:outputText value="#{coll.quantifier.value()}" />
					</rich:column>
					<rich:column styleClass="#{!coll.active ? 'invalidRow' : ''}" rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Informazione vincolante</f:facet>
						<h:outputText value="#{coll.conditionalPropertyDef!=null ? coll.conditionalPropertyDef.name : ''}" />
					</rich:column>
					<rich:column styleClass="#{!coll.active ? 'invalidRow' : ''}" rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Valore informazione vincolante</f:facet>
						<h:outputText value="#{coll.conditionalPropertyInst.stringValue}"
								rendered="#{coll.conditionalPropertyInst.dataDefinition.dataType == 'STRING' or dataInstance.dataDefinition.dataType == 'LINK'}"/>
						<h:outputText value="#{coll.conditionalPropertyInst.integerValue}"
								rendered="#{coll.conditionalPropertyInst.dataDefinition.dataType == 'INTEGER'}" />
						<h:outputText value="#{coll.conditionalPropertyInst.booleanValue ? 'true' : 'false'}"
								rendered="#{coll.conditionalPropertyInst.dataDefinition.dataType == 'BOOLEAN'}" />
						<h:outputText value="#{coll.conditionalPropertyInst.dateValue}"
								rendered="#{coll.conditionalPropertyInst.dataDefinition.dataType == 'DATE'}">
							<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="#{!coll.active ? 'invalidRow' : ''}">
						<f:facet name="header">Regole in cui è coinvolta</f:facet>
						<a:repeat var="rule" value="#{slotDefEditBean.retrieveReferencedRules(coll)}" rowKeyVar="idx">
							<h:outputText value="Regola #{rule.id}"/>
							<h:outputText value=", " rendered="#{idx lt slotDefEditBean.retrieveReferencedRules(coll).size()-1}"/>
						</a:repeat>
					</rich:column>
					<rich:column styleClass="action #{!coll.active ? 'invalidRow' : ''}">
						<f:facet name="header">Azioni</f:facet>
	                		<a:commandLink value="Modifica" action="#{slotDefEditBean.editColl(coll)}" oncomplete="#{rich:component('collPanel')}.show()" 
	                					reRender="collPanel"
	                					disabled="#{not coll.active}" 
										styleClass="#{not coll.active ? 'disabledLink' : ''}"/>
							#{'  '}
							<a:commandLink id="delete" value="Elimina" action="#{slotDefEditBean.removeColl(coll)}" 
									onclick="if(!confRules('#{slotDefEditBean.retrieveReferencedRulesLabel(coll)}')){return false;}else{dirty=true;}"
									reRender="epropTable,propPanel,collTable,propTable"
									rendered="#{not slotDefHome.referenced or coll.id==null}"/>
									
						 	<a:commandLink id="invalidate" value="#{coll.active ? 'Invalida' : 'Riattiva'}" action="#{slotDefEditBean.invalidate(coll)}"
						 			onclick="dirty=true"
            						disabled="#{not empty slotDefEditBean.retrieveReferencedRules(coll)}"
            						styleClass="#{not empty slotDefEditBean.retrieveReferencedRules(coll) ? 'disabledLink' : ''}"
            						reRender="collTable"
            						rendered="#{slotDefHome.referenced and coll.id!=null}"/>
            				<rich:toolTip for="invalidate" attached="true" rendered="#{not empty slotDefEditBean.retrieveReferencedRules(coll)}">
            				La richiesta è coinvolta in una regola e non può essere rimossa. Eliminare prima la regola che la referenzia</rich:toolTip>
					</rich:column>
				</rich:dataTable>
			</s:decorate>
			
			
			<div style="clear:both"/>
			<rich:separator height="15px" lineType="none" />
			
			
			<s:decorate template="/layout/display.xhtml" id="slotDefTable" rendered="#{slotDefHome.instance.type == 'GENERAL'}">
				<ui:define name="label">
	                <h:outputText value="Sottobuste" />
				</ui:define>
				<h:outputText value="Nessuna sottobusta definita" rendered="#{empty slotDefHome.instance.dependentSlotDefsAsList}"/>
				<rich:dataTable value="#{slotDefHome.instance.dependentSlotDefsAsList}" var="slot" 
						rendered="#{not empty slotDefHome.instance.dependentSlotDefsAsList}" style="width:1024px">
					<rich:column style="font-weight:bold;" styleClass="#{!slot.active ? 'invalidRow' : ''}">
						<f:facet name="header">Nome</f:facet>
						<h:graphicImage value="/img/cross.png"  styleClass="fileIcon"
							rendered="#{slot.status == 'INVALID'}" />
						<h:outputText value="#{slot.name}" />
					</rich:column>
					<rich:column styleClass="#{!slot.active ? 'invalidRow' : ''}">
						<f:facet name="header">Stato</f:facet>
						<h:outputText value="#{slot.status.value()}" />
					</rich:column>
					<rich:column styleClass="#{!slot.active ? 'invalidRow' : ''}"  rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Informazione vincolante</f:facet>
						<h:outputText value="#{slot.conditionalPropertyDef!=null ? slot.conditionalPropertyDef.name : ''}" />
					</rich:column>
					<rich:column styleClass="#{!slot.active ? 'invalidRow' : ''}"  rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Valore informazione vincolante</f:facet>
						<h:outputText value="#{slot.conditionalPropertyInst.stringValue}"
								rendered="#{slot.conditionalPropertyInst.dataDefinition.dataType == 'STRING' or dataInstance.dataDefinition.dataType == 'LINK'}"/>
						<h:outputText value="#{slot.conditionalPropertyInst.integerValue}"
								rendered="#{slot.conditionalPropertyInst.dataDefinition.dataType == 'INTEGER'}" />
						<h:outputText value="#{slot.conditionalPropertyInst.booleanValue ? 'true' : 'false'}"
								rendered="#{slot.conditionalPropertyInst.dataDefinition.dataType == 'BOOLEAN'}" />
						<h:outputText value="#{slot.conditionalPropertyInst.dateValue}"
								rendered="#{slot.conditionalPropertyInst.dataDefinition.dataType == 'DATE'}">
							<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
						</h:outputText>
					</rich:column>
					<rich:column styleClass="#{!slot.active ? 'invalidRow' : ''}" rendered="#{s:hasRole('ADMIN')}">
						<f:facet name="header">Info contenente numero di copie</f:facet>
						<h:outputText value="#{slot.numberOfInstances!=null ? slot.numberOfInstances.name : ''}" />
					</rich:column>
					<rich:column styleClass="#{!slot.active ? 'invalidRow' : ''}"  rendered="#{not s:hasRole('ADMIN')}">
						<f:facet id="header" name="header">Numero di copie</f:facet>
						<h:outputText value="#{slot.embeddedNumberOfInstances!=null ? slot.embeddedNumberOfInstances.value : ''}" />
					</rich:column>
					<rich:column styleClass="action #{!slot.active ? 'invalidRow' : ''}">
						<f:facet name="header">Azioni</f:facet>
						<a:commandLink value="Modifica"
									action="#{slotDefEditBean.editDependentSlotDef(slot)}"
						 			oncomplete="#{rich:component('dependentSlotDefPanel')}.show()"
						 			rendered="#{slot.id == null}"
						 			reRender="dependentSlotDefPanel"/>
						 			
						<s:link view="/admin/SlotDefWizardEdit.xhtml" value="Modifica" 
								rendered="#{slot.id != null}"
								propagation="none">
							<f:param name="mode" value="DEPENDENT"/>
							<f:param name="model" value="true"/>
							<f:param name="slotDefId" value="#{slot.id}"/>
						</s:link>
						#{'  '}
						<a:commandLink value="Elimina"
									action="#{slotDefEditBean.removeNotPersistedDependentSlotDef(slot)}"
						 			rendered="#{slot.id == null}"
						 			reRender="slotDefTable"/>
						 			
						<a:commandLink value="Elimina"
									action="#{slotDefEditBean.removePersistedDependentSlotDef(slot)}"
									disabled="#{slot.referenced}"
									styleClass="#{slot.referenced ? 'disabledLink' : ''}"
						 			rendered="#{slot.id != null}"
						 			reRender="slotDefTable"/>
					</rich:column>
				</rich:dataTable>
			</s:decorate>
			
			
			<s:decorate template="/layout/display.xhtml">
				<ui:define name="label">
	                <h:outputText value="" />
				</ui:define>
				<a:commandButton value="Aggiungi informazione relativa alla gara" 
							action="#{slotDefEditBean.newEmbeddedProperty()}" 
							oncomplete="#{rich:component('embeddedPropPanel')}.show()" 
							rendered="#{slotDefParameters.mode != 'PRIMARY'}"
							reRender="embeddedPropPanel"/>
                <h:graphicImage id="addInfoGara" value="/img/question-white.png" />
                <rich:toolTip for="addInfoGara" direction="bottom-left">Aggiungi informazione relativa alla gara</rich:toolTip>
							
				<a:commandButton value="Aggiungi informazione sull'azienda"
							onclick="if(#{slotDefHome.referenced}){if(!confirm('La Busta ha già istanze collegate, sicuri di volerlo modificare?')){return false;}}" 							 
							oncomplete="#{rich:component('propTypePanel')}.show()" 	
							reRender="pf,propPanel"
							rendered="#{s:hasRole('ADMIN')}"/>
                <h:graphicImage id="addInfoAzienda" value="/img/question-white.png" rendered="#{s:hasRole('ADMIN')}" />
                <rich:toolTip for="addInfoAzienda" direction="bottom-left">Aggiungi informazione relativa all'azienda</rich:toolTip>
							
				<a:commandButton value="Aggiungi richiesta" 
							onclick="if(#{slotDefHome.referenced}){if(!confirm('La Busta ha già istanze collegate, sicuri di volerlo modificare?')){return false;}}" 
							action="#{slotDefEditBean.newCollection()}" 
							oncomplete="#{rich:component('collTypePanel')}.show()" 
							reRender="collPanel"
							rendered="#{s:hasRole('ADMIN')}"/>
				<a:commandButton action="#{slotDefEditBean.newStandardCollection()}" 
							value="Aggiungi richiesta comune" 
							oncomplete="#{rich:component('collTypePanel')}.hide(); #{rich:component('collPanel')}.show();"
							reRender="collPanel,propPanel"
							rendered="#{not s:hasRole('ADMIN') and not slotDefHome.instance.template}"/>
                <h:graphicImage id="addRichiesta" value="/img/question-white.png" />
                <rich:toolTip for="addRichiesta" direction="bottom-left">Aggiungi documento richiesto dal disciplinare</rich:toolTip>
							
				<a:commandButton value="Aggiungi sottobusta"
							rendered="#{slotDefHome.instance.type == 'GENERAL' and s:hasRole('ADMIN')}" 						 
							oncomplete="#{rich:component('dependentSlotDefPanel')}.show()" 
							reRender="dependentSlotDefPanel"/>
				
				<a:commandButton value="Aggiungi sottobusta"
							action="#{slotDefEditBean.newSimplifiedDependentSlotDef()}"
							rendered="#{slotDefHome.instance.type == 'GENERAL' and not s:hasRole('ADMIN')}" 						 
							oncomplete="#{rich:component('dependentSlotDefPanel')}.show()" 
							reRender="dependentSlotDefPanel"/>					
                <h:graphicImage id="addSottoBusta" value="/img/question-white.png" />
                <rich:toolTip for="addSottoBusta" direction="bottom-left">In caso di partecipazione in Consorzio, ATI/RTI</rich:toolTip>
			</s:decorate>
			
            <div style="clear:both">
            </div>

        </rich:panel>

        <div class="actionButtons">
        
        	<h:commandButton id="assign"
                          value="Associa alla gara"
                           onclick="dirty = false;"
                         action="#{slotDefGaraAssociationtBean.persistAssociation()}"
                       disabled="#{!slotDefHome.wired}"
                       rendered="#{garaHome.garaId!=null and 
                       				garaHome.associatedSlotDef==null
                       				and slotDefHome.instance.type != 'DEPENDENT'}"/>
            <h:commandButton id="assignSettore"
                          value="Associa al settore"
                           onclick="dirty = false;"
                         action="#{slotDefSettoreAssociationBean.persistAssociation()}"
                       disabled="#{!slotDefHome.wired}"
                       rendered="#{settoreHome.settoreId != null and 
                                    settoreHome.associatedSlotDef==null
                                    and slotDefHome.instance.type == 'PRIMARY'}"/>

            <h:commandButton id="save"
                          value="Salva"
                           onclick="dirty = false;"
                         action="#{slotDefEditBean.save()}"
                       disabled="#{!slotDefHome.wired}"
                       rendered="#{!slotDefHome.managed and garaHome.garaId == null}"/>

            <h:commandButton id="update"
                          value="Salva"
                        onclick="dirty = false;"
                         action="#{slotDefEditBean.update()}"
                       rendered="#{slotDefHome.managed}"/>

            <h:commandButton id="delete"
                          value="Elimina"
                         action="#{slotDefHome.remove}"
                      immediate="true"
                       rendered="#{slotDefHome.managed}"
                       disabled="#{slotDefHome.referenced}"/>
                       
            <s:button view="/admin/SlotDefView.xhtml" value="Indietro" 
            		propagation="none"
            		rendered="#{slotDefHome.instance.id != null}">
               	<f:param name="mode" value="#{slotDefHome.instance.type.name()}"/>
				<f:param name="model" value="#{slotDefHome.instance.template}"/>
				<f:param name="slotDefId" value="#{slotDefHome.instance.id}"/>
	        </s:button>
	        
	        <s:button view="/admin/SlotDefWizardEdit.xhtml" value="Annulla Modifiche" 
	        	style="float:right"	propagation="none" includePageParams="true"/>

        </div>

    </h:form>
    
       <rich:modalPanel id="collTypePanel" autosized="true" minWidth="500"
				resizeable="false">
			<f:facet name="header">
				<h:outputText value="Scegli la tipologia di richiesta" />
			</f:facet>
			<a:form id="ctpf" onkeypress="dirty=true">
			<s:div style="text-align: center">
				<a:commandButton action="#{slotDefEditBean.newStandardCollection()}" 
							value="Aggiungi richiesta comune" 
							oncomplete="#{rich:component('collTypePanel')}.hide(); #{rich:component('collPanel')}.show();"
							reRender="collPanel,propPanel"/>
				#{' '}
				<a:commandButton action="#{slotDefEditBean.newConditionalPropertyForCollection()}" 
							value="Aggiungi richiesta vincolata" 
							oncomplete="#{rich:component('collTypePanel')}.hide(); #{rich:component('selectCondProp')}.show();"
							reRender="pf,collPanel,propPanel,selectCondProp"/>
	        <div style="clear:both"/>
	        </s:div>
	        <a:region>
			<a:commandButton value="Annulla" oncomplete="#{rich:component('collTypePanel')}.hide()" reRender="pf,propPanel,collPanel"/>
			</a:region>
			</a:form>
		</rich:modalPanel>
		
		
		<rich:modalPanel id="propTypePanel" autosized="true" minWidth="500"
				resizeable="false">
			<f:facet name="header">
				<h:outputText value="Scegli la tipologia di informazione" />
			</f:facet>
			<a:form id="ptpf" onkeypress="dirty=true">
			<s:div style="text-align: center">
				<a:commandButton action="#{slotDefEditBean.newStandardProperty()}" 
							value="Aggiungi informazione standard" 
							oncomplete="#{rich:component('propTypePanel')}.hide(); #{rich:component('propPanel')}.show();"
							reRender="collPanel,propPanel"/>
				#{' '}
				<a:commandButton action="#{slotDefEditBean.newConditionalPropertyForProperty()}" 
							value="Aggiungi informazione vincolata" 
							oncomplete="#{rich:component('propTypePanel')}.hide(); #{rich:component('selectCondProp')}.show();"
							reRender="pf,collPanel,propPanel,selectCondProp"/>
	        <div style="clear:both"/>
	        </s:div>
	        <a:region>
			<a:commandButton value="Annulla" oncomplete="#{rich:component('propTypePanel')}.hide()" reRender="pf,propPanel,collPanel"/>
			</a:region>
			</a:form>
		</rich:modalPanel>
		
		
		<rich:modalPanel id="selectCondProp" autosized="true" minWidth="500"
				resizeable="false">
			<f:facet name="header">
				<h:outputText value="Scegli l'informazione vincolante" />
			</f:facet>
			<a:form id="scp" onkeypress="dirty=true">
				<ui:param name="customType" value="p" />
				<s:decorate template="/layout/edit.xhtml" id="condPD" rendered="#{not slotDefEditBean.conditioned.equals('none')}">
	                <ui:define name="label">
	                	<h:outputText value="Informazione vincolante" />
					</ui:define>
					<h:selectOneMenu  value="#{slotDefEditBean.collection.conditionalPropertyDef}" 
								converter="propertyDefConverter"
								rendered="#{slotDefEditBean.conditioned.equals('Collection')}">
     					<s:selectItems value="#{slotDefHome.instance.propertyDefsAsList}" label="#{propertyDef.name}"
									var="propertyDef"  noSelectionLabel="-- select a value --" 
									itemLabel="#{propertyDef.id}" itemValue="#{propertyDef.id}:#{propertyDef.uuid}" 
									disabled="#{(not propertyDef.multiple) and (propertyDef.dictionary == null) and (propertyDef.dataType != 'BOOLEAN')}"/>
						<a:support event="onchange" action="#{slotDefEditBean.conditionalPropertyListenerForConditionable(slotDefEditBean.collection)}" reRender="scp"/>
					</h:selectOneMenu>
					
					<h:selectOneMenu  value="#{slotDefEditBean.propertyDef.conditionalPropertyDef}" 
								converter="propertyDefConverter"
								rendered="#{slotDefEditBean.conditioned.equals('Property')}">
     					<s:selectItems value="#{slotDefHome.instance.propertyDefsAsList}" label="#{propertyDef.name}"
									var="propertyDef"  noSelectionLabel="-- select a value --" 
									itemLabel="#{propertyDef.id}" itemValue="#{propertyDef.id}:#{propertyDef.uuid}" 
									disabled="#{(not propertyDef.multiple) and (propertyDef.dictionary == null) and (propertyDef.dataType != 'BOOLEAN')}"/>
						<a:support event="onchange" action="#{slotDefEditBean.conditionalPropertyListenerForConditionable(slotDefEditBean.propertyDef)}" reRender="scp"/>
					</h:selectOneMenu>
	            </s:decorate>
			<s:div>
	        <div style="clear:both"/>
	        </s:div>
	        <s:div id="selectCondProp_buttons">
	        <a:commandButton value="Ok" 
	        			oncomplete="#{rich:component('selectCondProp')}.hide();#{rich:component('collPanel')}.show();" 
	        			reRender="pf,propPanel,collPanel"
	        			rendered="#{slotDefEditBean.conditioned == 'Collection'}"/>
	       	<a:commandButton value="Ok" 
	       				action="#{slotDefEditBean.setConditional(false)}"
	        			oncomplete="#{rich:component('selectCondProp')}.hide();#{rich:component('propPanel')}.show();" 
	        			reRender="pf,propPanel,collPanel"
	        			rendered="#{slotDefEditBean.conditioned == 'Property'}"/>
	        <a:commandButton value="Definisci una nuova informazione" 
	        			oncomplete="#{rich:component('selectCondProp')}.hide();#{rich:component('propPanel')}.show();" 
	        			disabled="#{(slotDefEditBean.conditioned.equals('Collection') and slotDefEditBean.collection.conditionalPropertyDef != null) or
	        						(slotDefEditBean.conditioned.equals('Property') and slotDefEditBean.propertyDef.conditionalPropertyDef != null)}"
	        			reRender="pf,propPanel,collPanel"/>
	        <a:region>
			<a:commandButton value="Annulla" action="#{slotDefEditBean.clearEditing()}" oncomplete="#{rich:component('selectCondProp')}.hide()" reRender="pf,propPanel,collPanel,selectCondProp"/>
			</a:region>
			</s:div>
			</a:form>
		</rich:modalPanel>
    

       <rich:modalPanel id="propPanel" autosized="true" minWidth="600"
				resizeable="false">
			<f:facet name="header">
				<h:outputText value="Descrizione dell'informazione" />
			</f:facet>
			<a:form id="pf" onkeypress="dirty=true">
				<script type="text/javascript">
					var pinvalid = false;
				</script>
				<ui:param name="customType" value="p" />
				<ui:param name="prefix" value="p" />
			<s:div>
				<s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Nome dell'informazione #{slotDefEditBean.propertyDef.conditionalPropertyDef!=null ? 'Vincolata' : ''}"/>
					</ui:define>
					<h:inputText value="#{slotDefEditBean.propertyDef.name}" required="true" styleClass="ptext"/>
	            </s:decorate>
	            
	            <a:region>
	            <s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Tipologia del dato" />
					</ui:define>
					<h:selectOneMenu id="pDataType" value="#{slotDefEditBean.propertyDef.dataType}" 
							required="true"
							disabled="#{not empty slotDefEditBean.retrieveReferencedRules(slotDefEditBean.propertyDef) or
										(slotDefEditBean.propertyDef.id!=null and slotDefHome.referenced)}">
                    	<s:selectItems value="#{dataTypes}" var="type" label="#{type.value()}" noSelectionLabel="-- seleziona un tipo --"/>
					<a:support event="onchange" reRender="dictionary, pValidator"/>
             		</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            
	            <a:region>
	            <s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Validatore" />
					</ui:define>
					<h:selectOneMenu id="pValidator" value="#{slotDefEditBean.propertyDef.constraint}"
								disabled="#{slotDefEditBean.propertyDef.dictionary != null}">
                    	<s:selectItems value="#{constraintListManager.retrieveByType(slotDefEditBean.propertyDef.dataType)}" var="constr" label="#{constr.name}" noSelectionLabel="-- seleziona un validatore --"/>
                    	<s:convertEntity/>
						<a:support event="onchange" reRender="dictionary"/>
             		</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            
	            <s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Informazione obbligatoria" />
					</ui:define>
					<h:selectBooleanCheckbox value="#{slotDefEditBean.propertyDef.required}" />
	            </s:decorate>

	            <a:region>
	            <s:decorate template="/layout/edit.xhtml" rendered="#{slotDefEditBean.propertyDef.dataType != 'BOOLEAN' and not slotDefEditBean.conditional}">
	                <ui:define name="label">
	                	<h:outputText value="Accetta valori multipli" />
					</ui:define>
					<h:selectBooleanCheckbox value="#{slotDefEditBean.propertyDef.multiple}" 
										disabled="#{not empty slotDefEditBean.retrieveReferencedRules(slotDefEditBean.propertyDef) or
										(slotDefEditBean.propertyDef.id!=null and slotDefHome.referenced)}">
						<a:support event="onchange" reRender="dictionary"/>
					</h:selectBooleanCheckbox>
	            </s:decorate>
	            </a:region>
	            
	       		<a:region>
	            <s:decorate template="/layout/edit.xhtml" rendered="#{not slotDefEditBean.conditional or slotDefEditBean.edit}">
	                <ui:define name="label">
	                	<h:outputText value="Informazione vincolante" />
					</ui:define>
					<h:selectOneMenu  value="#{slotDefEditBean.propertyDef.conditionalPropertyDef}" 
								converter="propertyDefConverter"
								disabled="#{not slotDefEditBean.conditioned.equals('none') and not slotDefEditBean.edit}">
     					<s:selectItems value="#{slotDefHome.instance.propertyDefsAsList}" label="#{propertyDef.name}"
									var="propertyDef"  noSelectionLabel="-- select a value --" itemLabel="#{propertyDef.id}" itemValue="#{propertyDef.id}:#{propertyDef.uuid}" 
									disabled="#{(not propertyDef.multiple) and (propertyDef.dictionary == null) and (propertyDef.dataType != 'BOOLEAN') or propertyDef.uuid==slotDefEditBean.propertyDef.uuid}"/>
						<a:support event="onchange" action="#{slotDefEditBean.conditionalPropertyListenerForConditionable(slotDefEditBean.propertyDef)}" reRender="condValue"/>
					</h:selectOneMenu>
	            </s:decorate>
				</a:region>	
					
				<s:div id="condValue">
				<s:decorate  template="/layout/edit.xhtml" rendered="#{slotDefEditBean.propertyDef.conditionalPropertyDef != null}" >	            	
	                <ui:define name="label">
	                	<h:outputText value="Valore vincolante" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.propertyDef.conditionalPropertyInst.stringValue}"
							rendered="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dataType == 'STRING' and slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.propertyDef.conditionalPropertyDef != null}"/>
						<h:inputText value="#{slotDefEditBean.propertyDef.conditionalPropertyInst.integerValue}"
							rendered="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dataType == 'INTEGER' and slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.propertyDef.conditionalPropertyDef != null}"/>
						<h:selectBooleanCheckbox value="#{slotDefEditBean.propertyDef.conditionalPropertyInst.booleanValue}"
							rendered="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dataType == 'BOOLEAN'}"
							required="#{slotDefEditBean.propertyDef.conditionalPropertyDef != null}"/>
						<rich:calendar id="subscriptionDate" mode="client"
							value="#{slotDefEditBean.propertyDef.conditionalPropertyInst.dateValue}" datePattern="dd/MM/yyyy"
							rendered="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dataType == 'DATE' and slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.propertyDef.conditionalPropertyDef != null}"/>
							
						
						<h:selectOneMenu value="#{slotDefEditBean.propertyDef.conditionalPropertyInst.stringValue}" required="#{slotDefEditBean.propertyDef.conditionalPropertyDef != null}"
									rendered="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dataType == 'STRING' and slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
             			</h:selectOneMenu>
             			<h:selectOneMenu value="#{slotDefEditBean.propertyDef.conditionalPropertyInst.integerValue}" required="#{slotDefEditBean.propertyDef.conditionalPropertyDef != null}"
									rendered="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dataType == 'INTEGER' and slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
             			</h:selectOneMenu>
             			<h:selectOneMenu value="#{slotDefEditBean.propertyDef.conditionalPropertyInst.dateValue}"  required="#{slotDefEditBean.propertyDef.conditionalPropertyDef != null}"
             						rendered="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dataType == 'DATE' and slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.propertyDef.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
							<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
             			</h:selectOneMenu>
	            </s:decorate>
	            </s:div>
	            
	            <s:decorate id="dictionary" template="/layout/edit.xhtml" rendered="#{slotDefEditBean.propertyDef.dataType != 'BOOLEAN'}">
	                <ui:define name="label">
	                	<h:outputText value="Dizionario associato" />
					</ui:define>
					<h:selectOneMenu value="#{slotDefEditBean.propertyDef.dictionary}" 
									required="#{slotDefEditBean.propertyDef.multiple or (slotDefEditBean.conditional and not slotDefEditBean.conditioned.equals('none'))}"
									disabled="#{slotDefEditBean.propertyDef.id!=null and slotDefHome.referenced}">
                    		<s:selectItems value="#{dictionayListManager.retrieveByType(slotDefEditBean.propertyDef.dataType)}" 
											var="dictionary" label="#{dictionary.name}" noSelectionLabel="-- seleziona un dizionario --"/>
							<s:convertEntity/>
							<a:support event="onchange" reRender="pValidator" action="#{slotDefEditBean.resetPValidator()}"/>
             		</h:selectOneMenu>
	            </s:decorate>

	        </s:div>
	        <div style="clear:both"/>
			<a:commandButton value="Ok" action="#{slotDefEditBean.addProperty()}" oncomplete="if(!pinvalid){#{rich:component('propPanel')}.hide();}" 
							rendered="#{not slotDefEditBean.conditional or slotDefEditBean.edit}"	
							reRender="pf,slotDef,condPD,scp"/>
			<a:commandButton value="Ok" action="#{slotDefEditBean.addConditionalPropertyForCollection()}" oncomplete="if(!pinvalid){#{rich:component('propPanel')}.hide();#{rich:component('collPanel')}.show();}" 
							rendered="#{slotDefEditBean.conditional and slotDefParameters.wizard and not slotDefEditBean.edit and slotDefEditBean.conditioned.equals('Collection')}"	
							reRender="slotDef,cpf,pf,scp,collPanel"/>
								
			<a:commandButton value="Ok" action="#{slotDefEditBean.addConditionalPropertyForProperty()}" oncomplete="if(!pinvalid){#{rich:component('propPanel')}.hide();#{rich:component('propPanel')}.show()}" 
								rendered="#{slotDefEditBean.conditional == true and slotDefEditBean.conditioned.equals('Property')}"
								reRender="pf,slotDef,condPD,scp,propPanel"/>
							
			<a:region>
			<a:commandButton value="Annulla" action="#{slotDefEditBean.clearEditing()}" oncomplete="#{rich:component('propPanel')}.hide()" reRender="pf,propPanel,collPanel, scp"/>
			</a:region>
			<a:commandButton value="Aggiorna" styleClass="rightCommand" reRender="pf"/>
			</a:form>
		</rich:modalPanel>
		

		<rich:modalPanel id="embeddedPropPanel" autosized="true" minWidth="600"
				resizeable="false">
			<f:facet name="header">
				<h:outputText value="Descrizione dell'informazione" />
			</f:facet>
			<a:form id="epForm" onkeypress="dirty=true">
				<script type="text/javascript">
					var epinvalid = false;
				</script>
				<ui:param name="customType" value="p" />
				<ui:param name="prefix" value="ep" />
			<s:div id="embeddedPropValue">
				<s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Nome dell'informazione" styleClass="ptext"/>
					</ui:define>
					<h:inputText value="#{slotDefEditBean.embeddedProperty.name}" required="true"/>
	            </s:decorate>

				<a:region>
	            <s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Tipologia del dato" />
					</ui:define>
					<h:selectOneMenu id="pDataType" value="#{slotDefEditBean.embeddedProperty.dataType}" 
								required="true" 
								disabled="#{not empty slotDefEditBean.retrieveReferencedRules(slotDefEditBean.embeddedProperty)}">
                    	<s:selectItems value="#{dataTypes}" var="type" label="#{type.value()}"
							noSelectionLabel="-- seleziona un tipo --"/>
						<s:convertEnum/>
					<a:support event="onchange" action="#{slotDefEditBean.embeddedPropertyListener}" reRender="dictionary, epValue,epValidator"/>
             		</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            
	            <a:region>
	            <s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Validatore" />
					</ui:define>
					<h:selectOneMenu id="epValidator" value="#{slotDefEditBean.embeddedProperty.constraint}"
								disabled="#{slotDefEditBean.embeddedProperty.dictionary != null}">
                    	<s:selectItems value="#{constraintListManager.retrieveByType(slotDefEditBean.embeddedProperty.dataType)}" var="constr" label="#{constr.name}" noSelectionLabel="-- seleziona un validatore --"/>
                    	<s:convertEntity/>
						<a:support event="onchange" reRender="dictionary,epValue"/>
             		</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            
	            <a:region>
	            <s:decorate template="/layout/edit.xhtml" rendered="#{slotDefEditBean.embeddedProperty.dataType != 'BOOLEAN'}">
	                <ui:define name="label">
	                	<h:outputText value="Accetta valori multipli" />
					</ui:define>
					<h:selectBooleanCheckbox value="#{slotDefEditBean.embeddedProperty.multiple}" 
								disabled="#{not empty slotDefEditBean.retrieveReferencedRules(slotDefEditBean.embeddedProperty)}">
						<a:support event="onchange" action="#{slotDefEditBean.embeddedProperty.clean}" reRender="dictionary,epValue"/>
					</h:selectBooleanCheckbox>
	            </s:decorate>
	            </a:region>
				
				<a:region>
	            <s:decorate id="dictionary" template="/layout/edit.xhtml" rendered="#{slotDefEditBean.embeddedProperty.dataType != 'BOOLEAN'}">
	                <ui:define name="label">
	                	<h:outputText value="Dizionario associato" />
					</ui:define>
					<h:selectOneMenu value="#{slotDefEditBean.embeddedProperty.dictionary}" required="#{slotDefEditBean.embeddedProperty.multiple}"
								disabled="#{not empty slotDefEditBean.retrieveReferencedRules(slotDefEditBean.embeddedProperty)}">
                    		<s:selectItems value="#{dictionayListManager.retrieveByType(slotDefEditBean.embeddedProperty.dataType)}" 
											var="dictionary" label="#{dictionary.name}" noSelectionLabel="-- seleziona un dizionario --"/>
							<s:convertEntity/>
					<a:support event="onchange" action="#{slotDefEditBean.onChangeEmbeddedPropertyDictionary()}"  reRender="epValue,epValidator"/>
             		</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            
	            <s:div  id="epValue">
		            <s:decorate template="/layout/edit.xhtml" rendered="#{slotDefEditBean.embeddedProperty.dataType != null}">
		                <ui:define name="label">
		                	<h:outputText value="Valore" />
						</ui:define>
							
							<s:fragment rendered="#{not slotDefEditBean.embeddedProperty.multiple}">
							<h:inputText value="#{slotDefEditBean.embeddedProperty.stringValue}"
								rendered="#{(slotDefEditBean.embeddedProperty.dataDefinition.dataType == 'STRING' or slotDefEditBean.embeddedProperty.dataDefinition.dataType == 'LINK') and slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues == null}"
								required="#{not slotDefParameters.model}"
								disabled="#{not slotDefEditBean.embeddedProperty.dataDefinition.editable}" 
								validator="#{slotDefEditBean.embeddedProperty.validate}"/>
							<h:inputText value="#{slotDefEditBean.embeddedProperty.integerValue}"
								rendered="#{slotDefEditBean.embeddedProperty.dataDefinition.dataType == 'INTEGER' and slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues == null}"
								required="#{not slotDefParameters.model}"
								disabled="#{not slotDefEditBean.embeddedProperty.dataDefinition.editable}" 
								validator="#{slotDefEditBean.embeddedProperty.validate}"/>
							<a:region>
							<h:selectBooleanCheckbox value="#{slotDefEditBean.embeddedProperty.booleanValue}"
								rendered="#{slotDefEditBean.embeddedProperty.dataDefinition.dataType == 'BOOLEAN'}"
								required="#{not slotDefParameters.model}"
								disabled="#{not slotDefEditBean.embeddedProperty.dataDefinition.editable}">
							</h:selectBooleanCheckbox>
							</a:region>
							<rich:calendar id="subscriptionDate" mode="client"
								value="#{slotDefEditBean.embeddedProperty.dateValue}" datePattern="dd/MM/yyyy"
								rendered="#{slotDefEditBean.embeddedProperty.dataDefinition.dataType == 'DATE' and slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues == null}"
								required="#{not slotDefParameters.model}"
								disabled="#{not slotDefEditBean.embeddedProperty.dataDefinition.editable}" />
							
							<h:selectOneMenu value="#{slotDefEditBean.embeddedProperty.stringValue}" required="#{not slotDefParameters.model}"
										rendered="#{slotDefEditBean.embeddedProperty.dataDefinition.dataType == 'STRING' and slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues != null}"
										valueChangeListener="#{valueChangeListener.listener}">
	                    		<s:selectItems value="#{slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues}" 
												var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
	             			</h:selectOneMenu>
	             			<h:selectOneMenu value="#{slotDefEditBean.embeddedProperty.integerValue}" required="#{not slotDefParameters.model}"
	             						rendered="#{slotDefEditBean.embeddedProperty.dataDefinition.dataType == 'INTEGER' and slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues != null}"
	             						valueChangeListener="#{valueChangeListener.listener}">
	                    		<s:selectItems value="#{slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues}" 
												var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
	             			</h:selectOneMenu>
	             			<h:selectOneMenu value="#{slotDefEditBean.embeddedProperty.dateValue}"  required="#{not slotDefParameters.model}"
	             						rendered="#{slotDefEditBean.embeddedProperty.dataDefinition.dataType == 'DATE' and slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues != null}"
	             						valueChangeListener="#{valueChangeListener.listener}">
	                    		<s:selectItems value="#{slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues}" 
												var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
								<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
	             			</h:selectOneMenu>
	             			</s:fragment>
	             			
	             			<s:fragment rendered="#{slotDefEditBean.embeddedProperty.multiple and slotDefEditBean.embeddedProperty.dictionary != null}">
	             			<rich:pickList value="#{slotDefEditBean.embeddedProperty.valuesAsList}" required="#{not slotDefParameters.model}"
	             							onlistchanged="dirty=true">
								<s:selectItems value="#{slotDefEditBean.embeddedProperty.dataDefinition.dictionaryValues}" var="value" label="#{value}" />
							</rich:pickList>
							</s:fragment>
		            </s:decorate>
	            </s:div>
	        </s:div>
	        <div style="clear:both"/>
			<a:commandButton value="Ok" action="#{slotDefEditBean.addEmbeddedProperty()}" oncomplete="if(!epinvalid){#{rich:component('embeddedPropPanel')}.hide();}" reRender="epForm,slotDef"/>
			<a:region>
			<a:commandButton value="Annulla" onclick="#{rich:component('embeddedPropPanel')}.hide()"/>
			</a:region>
			<a:commandButton value="Aggiorna" styleClass="rightCommand" reRender="epForm"/>
			</a:form>
		</rich:modalPanel>
		
		<!-- TODO: Per controllare il form uso la variabile invalid invece di cpfinvalid che non viene valorizzata.. -->
		<rich:modalPanel id="collPanel" autosized="true" minWidth="650"
				resizeable="false">
			<f:facet name="header">
				<h:outputText value="Descrizione della Richiesta #{slotDefEditBean.collection.conditionalPropertyDef != null ? 'Vincolata' : ''}" />
			</f:facet>
			<a:form id="cpf" onkeypress="dirty=true">
				<script type="text/javascript">
					var cinvalid = false;
				</script>
				<ui:param name="customType" value="p" />
				<ui:param name="prefix" value="c" />
			<s:div>
			
			
				<s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Nome della Richiesta"/>
					</ui:define>
					<h:inputText value="#{slotDefEditBean.collection.name}" required="true" styleClass="ptext"/>
	            </s:decorate>
	            
	            <s:fragment rendered="false">
	            <s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Min" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.collection.min}" />
	            </s:decorate>
	            <s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Max" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.collection.max}" />
	            </s:decorate>
	            </s:fragment>
	            
	            <a:region>
	            <s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Tipo di documento" />
					</ui:define>
					<h:selectOneMenu id="cDocDef" value="#{slotDefEditBean.collection.docDef}" 
								required="true"
								disabled="#{not empty slotDefEditBean.retrieveReferencedRules(slotDefEditBean.collection) or
											(slotDefEditBean.collection.id!=null and slotDefHome.referenced)}">
                    	<s:selectItems value="#{docDefList.resultList}" 
										var="docDef" label="#{docDef.name}" noSelectionLabel="-- seleziona una tipologia di documento --"/>
						<s:convertEntity/>
             		</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            
	            <s:div id="condPD">
	            <a:region>
	            <s:decorate template="/layout/edit.xhtml" rendered="#{slotDefEditBean.collection.conditionalPropertyDef!=null or slotDefEditBean.edit and s:hasRole('ADMIN')}" >
	                <ui:define name="label">
	                	<h:outputText value="Informazione vincolante" />
					</ui:define>
					<h:selectOneMenu  value="#{slotDefEditBean.collection.conditionalPropertyDef}" 
								converter="propertyDefConverter" 
								disabled="#{not slotDefEditBean.conditioned.equals('none') and not slotDefEditBean.edit}">
     					<s:selectItems value="#{slotDefHome.instance.propertyDefsAsList}" label="#{propertyDef.name}"
									var="propertyDef"  noSelectionLabel="-- select a value --" itemLabel="#{propertyDef.id}" itemValue="#{propertyDef.id}:#{propertyDef.uuid}" 
									disabled="#{(not propertyDef.multiple) and (propertyDef.dictionary == null) and (propertyDef.dataType != 'BOOLEAN')}"/>
						<a:support event="onchange" action="#{slotDefEditBean.conditionalPropertyListenerForConditionable(slotDefEditBean.collection)}" reRender="condPD, condPI"/>
					</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            </s:div>
				
				
				<s:div id="condPI">
	            <s:decorate  template="/layout/edit.xhtml" rendered="#{slotDefEditBean.collection.conditionalPropertyDef != null and s:hasRole('ADMIN')}" >	            	
	                <ui:define name="label">
	                	<h:outputText value="Valore vincolante" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.collection.conditionalPropertyInst.stringValue}"
							rendered="#{slotDefEditBean.collection.conditionalPropertyDef.dataType == 'STRING' and slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.collection.conditionalPropertyDef != null}"/>
						<h:inputText value="#{slotDefEditBean.collection.conditionalPropertyInst.integerValue}"
							rendered="#{slotDefEditBean.collection.conditionalPropertyDef.dataType == 'INTEGER' and slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.collection.conditionalPropertyDef != null}"/>
						<h:selectBooleanCheckbox value="#{slotDefEditBean.collection.conditionalPropertyInst.booleanValue}"
							rendered="#{slotDefEditBean.collection.conditionalPropertyDef.dataType == 'BOOLEAN'}"
							required="#{slotDefEditBean.collection.conditionalPropertyDef != null}"/>
						<rich:calendar id="subscriptionDate" mode="client"
							value="#{slotDefEditBean.collection.conditionalPropertyInst.dateValue}" datePattern="dd/MM/yyyy"
							rendered="#{slotDefEditBean.collection.conditionalPropertyDef.dataType == 'DATE' and slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.collection.conditionalPropertyDef != null}"/>
							
						
						<h:selectOneMenu value="#{slotDefEditBean.collection.conditionalPropertyInst.stringValue}" required="#{slotDefEditBean.collection.conditionalPropertyDef != null}"
									rendered="#{slotDefEditBean.collection.conditionalPropertyDef.dataType == 'STRING' and slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
             			</h:selectOneMenu>
             			<h:selectOneMenu value="#{slotDefEditBean.collection.conditionalPropertyInst.integerValue}" required="#{slotDefEditBean.collection.conditionalPropertyDef != null}"
									rendered="#{slotDefEditBean.collection.conditionalPropertyDef.dataType == 'INTEGER' and slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
             			</h:selectOneMenu>
             			<h:selectOneMenu value="#{slotDefEditBean.collection.conditionalPropertyInst.dateValue}"  required="#{slotDefEditBean.collection.conditionalPropertyDef != null}"
             						rendered="#{slotDefEditBean.collection.conditionalPropertyDef.dataType == 'DATE' and slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.collection.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
							<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
             			</h:selectOneMenu>
	            </s:decorate>
	            </s:div>	
	            
	            <a:region>
	            <s:decorate id="quantifier" template="/layout/edit.xhtml">
                	<ui:define name="label">Quantità</ui:define>
               		<h:selectOneMenu value="#{slotDefEditBean.collection.quantifier}" required="true">
                    	<s:selectItems value="#{quantifierTypes}" noSelectionLabel="-- seleziona una quantità --" 
							var="quantifierType" label="#{quantifierType.value()}"/>
						<s:convertEnum/>
             		</h:selectOneMenu>
            	</s:decorate>
            	</a:region>
	        </s:div>
	        <div style="clear:both"/>
			<a:commandButton value="Ok" action="#{slotDefEditBean.addConditionedCollection()}" oncomplete="if(!cinvalid){#{rich:component('collPanel')}.hide();}" reRender="cpf,pf,collTable,propTable,propPanel,selectCondProp"/>
			<a:region>
			<a:commandButton value="Annulla" action="#{slotDefEditBean.clearEditing()}" oncomplete="#{rich:component('collPanel')}.hide()" reRender="cpf"/>
			</a:region>
			<a:commandButton value="Aggiorna" styleClass="rightCommand" reRender="cpf"/>
			</a:form>
		</rich:modalPanel>
		
		
		<rich:modalPanel id="dependentSlotDefPanel" domElementAttachment="body" autosized="true" minWidth="500"
				resizeable="false" rendered="#{slotDefHome.instance.type != 'DEPENDENT'}">
			<f:facet name="header">
				<h:outputText value="Scegli la sottobusta" />
			</f:facet>
			<a:form id="dsdf" onkeypress="dirty=true">
				<ui:param name="customType" value="p" />
				<script type="text/javascript">
					var dsdinvalid = false;
				</script>
				<ui:param name="prefix" value="dsd" />
				
				<s:decorate template="/layout/display.xhtml" rendered="#{slotDefEditBean.edit and s:hasRole('ADMIN')}">
	                <ui:define name="label">
	                	<h:outputText value="Sottobusta" />
					</ui:define>
					<h:outputText value="#{slotDefEditBean.dependentSlotDef.name}" />
	            </s:decorate>
	            
	            <a:region>
				<s:decorate template="/layout/edit.xhtml" rendered="#{not s:hasRole('ADMIN')}">
	                <ui:define name="label">
	                	<h:outputText value="Nome Sottobusta" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.dependentSlotDef.name}" required="true"/>
	            </s:decorate>
	            </a:region>
				
				<a:region>
				<s:decorate template="/layout/edit.xhtml" rendered="#{not slotDefEditBean.edit and s:hasRole('ADMIN')}">
	                <ui:define name="label">
	                	<h:outputText value="Sottobusta" />
					</ui:define>
					<h:selectOneMenu  value="#{slotDefEditBean.dependentSlotDef}" required="true">
     					<s:selectItems value="#{slotDefListManager.retrieveMySlot(true, 'DEPENDENT')}" label="#{slot.name}"
									var="slot"  noSelectionLabel="-- select a value --"/>
							<a:support event="onchange" 
									action="#{slotDefEditBean.changeDependentSlotDefListener()}"		
									reRender="condPD,condValue,numberOfIstances" />
						<s:convertEntity/>
					</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
				
				<s:div id="condPD" rendered="#{s:hasRole('ADMIN') or slotDefHome.instance.template}">
				<a:region>
				<s:decorate template="/layout/edit.xhtml" rendered="#{slotDefEditBean.dependentSlotDef != null}">
	                <ui:define name="label">
	                	<h:outputText value="Informazione vincolante" />
					</ui:define>
					<h:selectOneMenu  value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef}"
								converter="propertyDefConverter">
     					<s:selectItems value="#{slotDefHome.instance.propertyDefsAsList}" label="#{propertyDef.name}"
									var="propertyDef"  noSelectionLabel="-- select a value --" 
									itemLabel="#{propertyDef.id}" itemValue="#{propertyDef.id}:#{propertyDef.uuid}" 
									disabled="#{(not propertyDef.multiple) and (propertyDef.dictionary == null) and (propertyDef.dataType != 'BOOLEAN')}"/>
						<a:support event="onchange" 
								action="#{slotDefEditBean.conditionalPropertyListenerForConditionable(slotDefEditBean.dependentSlotDef)}" 
								oncomplete="dirty = true"
								reRender="condValue"/>
					</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            </s:div>
	            
	            <s:div id="condValue" rendered="#{s:hasRole('ADMIN') or slotDefHome.instance.template}">
	            <a:region>
				<s:decorate  template="/layout/edit.xhtml" rendered="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef != null}" >	            	
	                <ui:define name="label">
	                	<h:outputText value="Valore vincolante" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyInst.stringValue}"
							rendered="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dataType == 'STRING' and slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef != null}"/>
						<h:inputText value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyInst.integerValue}"
							rendered="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dataType == 'INTEGER' and slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef != null}"/>
						<h:selectBooleanCheckbox value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyInst.booleanValue}"
							rendered="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dataType == 'BOOLEAN'}"
							required="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef != null}"/>
						<rich:calendar id="subscriptionDate" mode="client"
							value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyInst.dateValue}" datePattern="dd/MM/yyyy"
							rendered="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dataType == 'DATE' and slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues == null}"
							required="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef != null}"/>
							
						
						<h:selectOneMenu value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyInst.stringValue}" 
									onchange="dirty = true"
									required="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef != null}"
									rendered="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dataType == 'STRING' and slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
             			</h:selectOneMenu>
             			<h:selectOneMenu value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyInst.integerValue}" 
             						required="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef != null}"
             						onchange="dirty = true"
									rendered="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dataType == 'INTEGER' and slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
             			</h:selectOneMenu>
             			<h:selectOneMenu value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyInst.dateValue}"  
             						onchange="dirty = true"
             						required="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef != null}"
             						rendered="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dataType == 'DATE' and slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues != null}">
                    		<s:selectItems value="#{slotDefEditBean.dependentSlotDef.conditionalPropertyDef.dictionaryValues}" 
											var="value" label="#{value}" noSelectionLabel="-- seleziona un valore --"/>
							<s:convertDateTime type="date" dateStyle="short" pattern="dd/MM/yyyy" />
             			</h:selectOneMenu>
	            </s:decorate>
	            </a:region>
	            </s:div>
	            
	            <s:div id="numberOfIstances" >
				<a:region>
				<s:decorate template="/layout/edit.xhtml" rendered="#{s:hasRole('ADMIN')}">
	                <ui:define name="label">
	                	<h:outputText id="nclabel" value="Numero di copie" />
	                	<rich:toolTip for="nclabel">Deve essere selezionata una informazione di tipo NUMERO segnata come OBBLIGATORIA</rich:toolTip>
					</ui:define>
					<h:selectOneMenu  value="#{slotDefEditBean.dependentSlotDef.numberOfInstances}" 
								onchange="dirty = true"
								required="true"
								converter="propertyDefConverter">
     					<s:selectItems value="#{slotDefHome.instance.propertyDefsAsList}" label="#{propertyDef.name}"
									var="propertyDef"  noSelectionLabel="-- select a value --" 
									itemLabel="#{propertyDef.id}" itemValue="#{propertyDef.id}:#{propertyDef.uuid}" 
									disabled="#{propertyDef.dataType != 'INTEGER' or not propertyDef.required}"/>
					</h:selectOneMenu>
	            </s:decorate>
	            
				<s:decorate template="/layout/edit.xhtml" rendered="#{not s:hasRole('ADMIN')}">
	                <ui:define name="label">
	                	<h:outputText value="Numero copie sottobusta" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.dependentSlotDef.embeddedNumberOfInstances.integerValue}" required="true"/>
	            </s:decorate>

	            </a:region>
	            </s:div>
	            
			<s:div>
	        <div style="clear:both"/>
	        </s:div>
	        <a:jsFunction action="#{slotDefEditBean.clearEditing()}" name="clearEditing"/>
	        <a:commandButton value="Ok"
	        			action="#{slotDefEditBean.addClonedDependentSlotDef()}" 
	        			oncomplete="if(!dsdinvalid){#{rich:component('dependentSlotDefPanel')}.hide(); dirty=true;}"
	        			rendered="#{not slotDefEditBean.edit and s:hasRole('ADMIN')}" 
	        			reRender="dsdf,slotDefTable"/>
	        			
	        <a:commandButton value="Ok" 
	        			oncomplete="if(!dsdinvalid){#{rich:component('dependentSlotDefPanel')}.hide(); clearEditing();}"
	        			rendered="#{slotDefEditBean.edit}"
	        			reRender="dsdf,slotDefTable"/>
	        			
	        <a:commandButton value="Ok"
	        			action="#{slotDefEditBean.addSimplifiedDependentSlotDef()}" 
	        			oncomplete="if(!sdsdinvalid){#{rich:component('dependentSlotDefPanel')}.hide(); dirty=true;}"
	        			rendered="#{not slotDefEditBean.edit and not s:hasRole('ADMIN')}" 
	        			reRender="dsdf,slotDefTable"/>
	        			
	        <a:region>
			<a:commandButton value="Annulla"
							oncomplete="#{rich:component('dependentSlotDefPanel')}.hide(); clearEditing();" 
							rendered="#{slotDefEditBean.edit == true}"
							reRender="dsdf"/>
			</a:region>
			<a:region>
			<a:commandButton value="Annulla" action="#{slotDefEditBean.resetDependentSlotDefModel()}" 
							oncomplete="#{rich:component('dependentSlotDefPanel')}.hide()" 
							rendered="#{slotDefEditBean.edit == false}"
							reRender="dsdf"/>
			</a:region>
			</a:form>
		</rich:modalPanel>
		
		
		<rich:modalPanel id="simplifiedDependentSlotDefPanel" domElementAttachment="body" autosized="true" minWidth="500"
				resizeable="false" rendered="#{slotDefHome.instance.type != 'DEPENDENT'}">
			<f:facet name="header">
				<h:outputText value="Definisci i parametri della sottobusta" />
			</f:facet>
			<a:form id="sdsdf" onkeypress="dirty=true">
				<ui:param name="customType" value="p" />
				<script type="text/javascript">
					var sdsdinvalid = false;
				</script>
				<ui:param name="prefix" value="sdsd" />
				
				<a:region>
				<s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Nome Sottobusta" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.dependentSlotDef.name}" required="true"/>
	            </s:decorate>
	            </a:region>
	            
	            <a:region>
				<s:decorate template="/layout/edit.xhtml">
	                <ui:define name="label">
	                	<h:outputText value="Numero copie sottobusta" />
					</ui:define>
					<h:inputText value="#{slotDefEditBean.dependentSlotDef.embeddedNumberOfInstances.integerValue}" required="true"/>
	            </s:decorate>
	            </a:region>
				
				<div style="clear:both"/>
				<a:jsFunction action="#{slotDefEditBean.clearEditing()}" name="clearEditing"/>
				
				<a:commandButton value="Ok"
	        			action="#{slotDefEditBean.addSimplifiedDependentSlotDef()}" 
	        			oncomplete="if(!sdsdinvalid){#{rich:component('simplifiedDependentSlotDefPanel')}.hide(); dirty=true;}"
	        			rendered="#{not slotDefEditBean.edit}" 
	        			reRender="sdsdf,slotDefTable"/>
	        			
				<a:commandButton value="Annulla"
							oncomplete="#{rich:component('simplifiedDependentSlotDefPanel')}.hide(); clearEditing();" 
							reRender="sdsdf"/>
			</a:form>
		</rich:modalPanel>
		
		<script type="text/javascript">	
		function conf(c){
			if(c!=''){
				if(!confirm('L\'informazione è condizionale per le richieste: "'+c+'". Le richieste verranno mantenute ma perderanno il vincolo condizionale e diventeranno quindi obbligatorie.' + 
						'\nL\'eliminazione delle richieste, se necessaria, deve essere fatta manualmente una per una.\nContinuare?')){
					return false;
				}else{
					return true;
				}
			}
			return true;
		}

		function confInvalidate(c){
			if(c!=''){
				if(!confirm('L\'informazione è condizionale per le richieste: "'+c+'". Le richieste verranno invalidate insieme all\'informazione.' + 
						'\nContinuare?')){
					return false;
				}else{
					return true;
				}
			}
			return true;
		}

		function confRules(c){
			if(c!=''){
				if(!confirm('L\'informazione è coinvolta nelle regole: "'+c+'". In questo caso anche le regole verranno eliminate.\nContinuare?')){
					return false;
				}else{
					return true;
				}
			}
			return true;
		}
		</script>
		
			
</ui:define>

</ui:composition>
